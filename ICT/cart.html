<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tsukuyomi ‚Äî Gi·ªè h√†ng</title>
  <link rel="stylesheet" href="project.css" />
</head>
<body>
  <header class="site-nav">
    <div class="nav-inner">
      <div class="brand"><span class="logo"><a href="homepage.html"><img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXclG6vGeVLNuHB_K1YrMlL0h-9l-xpt5iuvETEmFEeIyIviDKQFqw3xOEhyIuqBQED9fc9uondVMHhz3qkMKnFI_UjF2L3SczX-isHgde_GdkuVilvmIpkoi13mQEDhnC6t6Npipg?key=G2E7dZCc18RHDI4Eo7786g" alt="logo"></a></span><a href="homepage.html"><span>Tsukuyomi</span></a>
        <nav class="main-nav">
          <a href="homepage.html">Trang Ch·ªß</a>
          <a href="products.html">S·∫£n ph·∫©m</a>
          <a href="introduct.html">Gi·ªõi thi·ªáu</a>
          <a href="aboutus.html">Th√†nh vi√™n</a>
          <a href="support.html">H·ªó tr·ª£</a>
        </nav>
      </div>
      <div class="nav-actions">
        <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">üëç</a>
        <a href="cart.html" class="active">üõí</a></div>
      </div>
    </div>
    <div class="promo">Xem l·∫°i nh·ªØng ƒë∆°n h√†ng c·ªßa b·∫°n</div>
  </header>

  <main style="margin-left: 20px;margin-right: 20px; margin-top: 120px;">
    <h1 class="title">Gi·ªè h√†ng c·ªßa b·∫°n</h1>
    <p class="subtitle">C√°c s·∫£n ph·∫©m b·∫°n ƒë√£ ch·ªçn:</p>

    <table id="cart-table">
      <thead>
        <tr>
          <th>S·∫£n ph·∫©m</th>
          <th>S·ªë l∆∞·ª£ng</th>
          <th>Gi√°</th>
          <th>T·ªïng</th>
          <th>Tr·∫£ g√≥p (12 th√°ng)</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody id="cart-body"></tbody>
    </table>

    <div class="summary">
      <strong id="total-items">T·ªïng s·ªë l∆∞·ª£ng: 0</strong><br>
      <strong id="total-price">T·ªïng c·ªông: 0‚Ç´</strong><br>
      <strong id="monthly-price">Tr·∫£ g√≥p m·ªói th√°ng (12 th√°ng): 0‚Ç´/th√°ng</strong>
    </div>

    <div class="summary">
      <button id="purcharse">Thanh to√°n gi·ªè h√†ng</button>
      <button id="clear-cart">X√≥a to√†n b·ªô gi·ªè h√†ng</button>
    </div>

    <div id="bill-popup">
      <div id="bill-container">
        <h2>H√≥a ƒë∆°n thanh to√°n</h2>
        <div id="bill-content"></div>
        <div style="text-align:center;">
          <button id="close-bill">ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    function formatCurrency(num) {
      return num.toLocaleString('vi-VN') + '‚Ç´';
    }

    function saveCart(cart) {
      localStorage.setItem('globalCart', JSON.stringify(cart));
    }

    function deleteItem(index) {
      let cart = JSON.parse(localStorage.getItem('globalCart')) || [];
      cart.splice(index, 1);
      saveCart(cart);
      loadCart();
    }

    function loadCart() {
      const cartBody = document.getElementById('cart-body');
      const totalItems = document.getElementById('total-items');
      const totalPrice = document.getElementById('total-price');
      const monthlyPrice = document.getElementById('monthly-price');

      const cart = JSON.parse(localStorage.getItem('globalCart')) || [];

      if (cart.length === 0) {
        cartBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Gi·ªè h√†ng tr·ªëng.</td></tr>';
        totalItems.textContent = 'T·ªïng s·ªë l∆∞·ª£ng: 0';
        totalPrice.textContent = 'T·ªïng c·ªông: 0‚Ç´';
        monthlyPrice.textContent = 'Tr·∫£ g√≥p m·ªói th√°ng (12 th√°ng): 0‚Ç´/th√°ng';
        return;
      }

      let totalQty = 0;
      let total = 0;
      let monthlyTotal = 0;
      cartBody.innerHTML = '';

      cart.forEach((item, index) => {
        const subtotal = item.price * item.quantity;
        const monthly = item.monthly * item.quantity;
        totalQty += item.quantity;
        total += subtotal;
        monthlyTotal += monthly;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${formatCurrency(item.price)}</td>
          <td>${formatCurrency(subtotal)}</td>
          <td>${formatCurrency(monthly)}</td>
          <td><button class="delete-btn" data-index="${index}">X√≥a</button></td>
        `;
        cartBody.appendChild(row);
      });

      totalItems.textContent = 'T·ªïng s·ªë l∆∞·ª£ng: ' + totalQty;
      totalPrice.textContent = 'T·ªïng c·ªông: ' + formatCurrency(total);
      monthlyPrice.textContent = 'Tr·∫£ g√≥p m·ªói th√°ng (1 th√°ng): ' + formatCurrency(monthlyTotal) + '/th√°ng';

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteItem(btn.getAttribute('data-index')));
      });
    }

    document.getElementById('clear-cart').addEventListener('click', () => {
      localStorage.removeItem('globalCart');
      loadCart();
      alert('Gi·ªè h√†ng ƒë√£ ƒë∆∞·ª£c x√≥a');
    });
    // document.getElementById('purcharse').addEventListener('click', () => {
    //   localStorage.removeItem('globalCart');
    //   loadCart();
    //   alert('ƒê√£ thanh to√°n gi·ªè h√†ng!');
    // });

    

    document.getElementById('purcharse').addEventListener('click', () => {
      const cart = JSON.parse(localStorage.getItem('globalCart')) || [];
      const popup = document.getElementById('bill-popup');
      const billContent = document.getElementById('bill-content');

      if (cart.length === 0) {
        alert('Gi·ªè h√†ng tr·ªëng...');
        return;
      }

      let total = 0;
      let monthly = 0;
      let html = `
        <table class="bill-table" >
          <tr class="bill-table-row">
            <th style="text-align:left;">S·∫£n ph·∫©m</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Gi√°</th>
            <th>T·ªïng</th>
          </tr>
      `;

      cart.forEach(item => {
        const sub = item.price * item.quantity;
        const month = item.monthly * item.quantity;
        total += sub;
        monthly += month;
        html += `
          <tr>
            <td>${item.name}</td>
            <td style="text-align:center;">${item.quantity}</td>
            <td style="text-align:right;">${formatCurrency(item.price)}</td>
            <td style="text-align:right;">${formatCurrency(sub)}</td>
          </tr>`;
      });

      html += `
        </table>
        <hr class="line">
        <p><strong>T·ªïng c·ªông:</strong> ${formatCurrency(total)}</p>
        <p><strong>Tr·∫£ g√≥p m·ªói th√°ng (12 th√°ng):</strong> ${formatCurrency(monthly)}/th√°ng</p>
        <p style="text-align:center;margin-top:20px;">C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng t·∫°i <b>Tsukuyomi</b>!</p>
      `;

      billContent.innerHTML = html;
      popup.style.display = 'flex';
      localStorage.removeItem('globalCart');
      loadCart();
    });

    document.getElementById('close-bill').addEventListener('click', () => {
      document.getElementById('bill-popup').style.display = 'none';
    });
    

    window.addEventListener('DOMContentLoaded', loadCart);
  </script>
</body>
</html>
